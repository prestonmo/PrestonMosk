"0","#| echo: false"
"0","cohort_bars <- flows |>"
"0","  filter(source_2020 %in% c(""Trump2020"",""Biden2020"")) |>"
"0","  mutate(category = case_when("
"0","    source_2020 == ""Trump2020"" & to_2024 == ""Trump""  ~ ""Retention"","
"0","    source_2020 == ""Biden2020"" & to_2024 == ""Harris"" ~ ""Retention"","
"0","    source_2020 == ""Trump2020"" & to_2024 == ""Harris"" ~ ""Switched"","
"0","    source_2020 == ""Biden2020"" & to_2024 == ""Trump""  ~ ""Switched"","
"0","    to_2024 == ""DidNotVote""                           ~ ""Drop-off"","
"0","    TRUE                                              ~ ""Other"""
"0","  )) |>"
"0","  group_by(source_2020, category) |>"
"0","  summarise(percent = sum(percent), .groups = ""drop"") |>"
"0","  mutate(category = factor(category, levels = c(""Retention"",""Switched"",""Drop-off"",""Other"")))"
"0",""
"0","p2 <- ggplot(cohort_bars, aes(source_2020, percent, fill = category)) +"
"0","  geom_col(position = position_dodge(width = 0.8), width = 0.7) +"
"0","  geom_text(aes(label = round(percent,1)),"
"0","            position = position_dodge(width = 0.8), vjust = -0.35, size = 3) +"
"0","  scale_y_continuous(labels = scales::percent_format(scale = 1),"
"0","                     expand = expansion(mult = c(0, .08))) +"
"0","  labs("
"0","    title = ""Retention vs Switching vs Drop-off (Side-by-Side Comparison)"","
"0","    x = ""2020 Cohort"", y = ""Share of Cohort (%)"", fill = ""Outcome in 2024"""
"0","  ) +"
"0","  theme_minimal(base_size = 12)"
"0","p2"
