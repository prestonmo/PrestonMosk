Midterm_2024$Label <- paste0(Midterm_2024$Value, "%")
# overlapping labels
library(ggplot2)
ggplot() +
geom_bar(data = Midterm_2020, aes(x = Variable, y = Value, fill = "2020"),
stat = "identity", position = "identity", alpha = 0.8) +
geom_text(data = Midterm_2020, aes(x = Variable, y = Value, label = Label),
position = position_nudge(x = -0.15, y = 0.5),
color = "black", size = 3.5) +
geom_bar(data = Midterm_2024, aes(x = Variable, y = Value, fill = "2024"),
stat = "identity", position = "identity", alpha = 0.4) +
geom_text(data = Midterm_2024, aes(x = Variable, y = Value, label = Label),
position = position_nudge(x = 0.15, y = -0.5),
color = "black", size = 3.5) +
scale_fill_manual(values = c("2020" = "#1f77c1", "2024" = "#FF0000")) +
labs(title = "Difference In Election Outcomes From 2020 To 2024",
x = "Candidates",
y = "Percentage of Vote",
fill = "Year") +
theme_minimal()
#| echo: false
# Original data
Midterm <- data.frame(
Year = c("2020", "2024"),
Democrat   = c(51.3, 48.3),
Republican = c(46.9, 49.8),
Other      = c(1.8, 1.9)
)
# Reshape to long format
Midterm_long <- pivot_longer(Midterm, cols = c(Democrat, Republican, Other),
names_to = "Candidate", values_to = "Percentage")
# Add label text
Midterm_long$Label <- paste0(Midterm_long$Percentage, "%")
# Apply nudging to vote percentage labels
Midterm_long <- Midterm_long %>%
mutate(
v_nudge = case_when(
Candidate == "Other"      ~ 2.1,
Candidate == "Democrat"   ~ -1.6,
Candidate == "Republican" ~ -1.0,
TRUE                      ~ 0
),
h_nudge = case_when(
Candidate == "Other"      ~ 0,
Candidate == "Democrat"   ~ 0.15,
Candidate == "Republican" ~ 0.15,
TRUE                      ~ 0
)
)
# Compute change labels and midpoint positions with nudging
change_labels <- Midterm %>%
summarise(
Democrat    = round(Democrat[Year == "2024"] - Democrat[Year == "2020"], 1),
Republican  = round(Republican[Year == "2024"] - Republican[Year == "2020"], 1),
Other       = round(Other[Year == "2024"] - Other[Year == "2020"], 1)
) %>%
pivot_longer(cols = everything(), names_to = "Candidate", values_to = "Change") %>%
mutate(
Label = paste0("Δ ", Change, "%"),
x = 1.5,
y = c(mean(c(51.3, 48.3)), mean(c(46.9, 49.8)), mean(c(1.8, 1.9))),
v_nudge = case_when(
Candidate == "Other"      ~ 1.5,
Candidate == "Democrat"   ~ 1,
Candidate == "Republican" ~ -1.5,
TRUE                      ~ 0
),
h_nudge = case_when(
Candidate == "Other"      ~ 0,
Candidate == "Democrat"   ~ 0.1,
Candidate == "Republican" ~ 0.1,
TRUE                      ~ 0
)
)
# Plot with moveable Δ labels
ggplot(Midterm_long, aes(x = Year, y = Percentage, group = Candidate, color = Candidate)) +
geom_line(linewidth  = 1.2, alpha = 0.8) +
geom_point(size = 4) +
geom_text(aes(x = as.numeric(as.factor(Year)) + h_nudge,
y = Percentage + v_nudge,
label = Label),
size = 3.5) +
geom_text(data = change_labels,
aes(x = x + h_nudge, y = y + v_nudge, label = Label, color = Candidate),
fontface = "bold", size = 4, inherit.aes = FALSE) +
scale_x_discrete(limits = c("2020", "2024")) +
scale_color_manual(values = c("Democrat" = "#1f77b4", "Republican" = "red", "Other" = "gray40")) +
labs(title = "Vote Share by Candidate (2020 vs 2024)",
subtitle = "Δ labels show change in vote share",
x = "Year",
y = "Percentage of Vote",
color = "Candidate") +
theme_minimal()
Midterm <- data.frame(
Year = c("2020", "2024"),
Democrat   = c(51.3, 48.3),
Republican = c(46.9, 49.8),
Other      = c(1.8, 1.9)
)
Midterm_long <- pivot_longer(Midterm, cols = c(Democrat, Republican, Other),
names_to = "Candidate", values_to = "Percentage")
label
Midterm <- data.frame(
Year = c("2020", "2024"),
Democrat   = c(51.3, 48.3),
Republican = c(46.9, 49.8),
Other      = c(1.8, 1.9)
)
Midterm_long <- pivot_longer(Midterm, cols = c(Democrat, Republican, Other),
names_to = "Candidate", values_to = "Percentage")
label
Midterm <- data.frame(
Year = c("2020", "2024"),
Democrat   = c(51.3, 48.3),
Republican = c(46.9, 49.8),
Other      = c(1.8, 1.9)
)
Midterm_long <- pivot_longer(Midterm, cols = c(Democrat, Republican, Other),
names_to = "Candidate", values_to = "Percentage")
Midterm_long$Label <- paste0(Midterm_long$Percentage, "%")
# labels placement
Midterm_long <- Midterm_long %>%
mutate(
v_nudge = case_when(
Candidate == "Other"      ~ 2.1,
Candidate == "Democrat"   ~ -1.6,
Candidate == "Republican" ~ -1.0,
TRUE                      ~ 0
),
h_nudge = case_when(
Candidate == "Other"      ~ 0,
Candidate == "Democrat"   ~ 0.15,
Candidate == "Republican" ~ 0.15,
TRUE                      ~ 0
)
)
# labels placement
change_labels <- Midterm %>%
summarise(
Democrat    = round(Democrat[Year == "2024"] - Democrat[Year == "2020"], 1),
Republican  = round(Republican[Year == "2024"] - Republican[Year == "2020"], 1),
Other       = round(Other[Year == "2024"] - Other[Year == "2020"], 1)
) %>%
pivot_longer(cols = everything(), names_to = "Candidate", values_to = "Change") %>%
mutate(
Label = paste0("Δ ", Change, "%"),
x = 1.5,
y = c(mean(c(51.3, 48.3)), mean(c(46.9, 49.8)), mean(c(1.8, 1.9))),
v_nudge = case_when(
Candidate == "Other"      ~ 1.5,
Candidate == "Democrat"   ~ 1,
Candidate == "Republican" ~ -1.5,
TRUE                      ~ 0
),
h_nudge = case_when(
Candidate == "Other"      ~ 0,
Candidate == "Democrat"   ~ 0.1,
Candidate == "Republican" ~ 0.1,
TRUE                      ~ 0
)
)
# Insert Δchange
ggplot(Midterm_long, aes(x = Year, y = Percentage, group = Candidate, color = Candidate)) +
geom_line(linewidth  = 1.2, alpha = 0.8) +
geom_point(size = 4) +
geom_text(aes(x = as.numeric(as.factor(Year)) + h_nudge,
y = Percentage + v_nudge,
label = Label),
size = 3.5) +
geom_text(data = change_labels,
aes(x = x + h_nudge, y = y + v_nudge, label = Label, color = Candidate),
fontface = "bold", size = 4, inherit.aes = FALSE) +
scale_x_discrete(limits = c("2020", "2024")) +
scale_color_manual(values = c("Democrat" = "#1f77b4", "Republican" = "red", "Other" = "gray40")) +
labs(title = "Vote Share by Candidate (2020 vs 2024)",
subtitle = "Δ labels show change in vote share",
x = "Year",
y = "Percentage of Vote",
color = "Candidate") +
theme_minimal()
#| echo: false
Midterm <- data.frame(
Year = c("2020", "2024"),
Democrat   = c(51.3, 48.3),
Republican = c(46.9, 49.8),
Other      = c(1.8, 1.9)
)
Midterm_long <- pivot_longer(Midterm, cols = c(Democrat, Republican, Other),
names_to = "Candidate", values_to = "Percentage")
label
#| echo: false
Midterm <- data.frame(
Year = c("2020", "2024"),
Democrat   = c(51.3, 48.3),
Republican = c(46.9, 49.8),
Other      = c(1.8, 1.9)
)
Midterm_long <- pivot_longer(Midterm, cols = c(Democrat, Republican, Other),
names_to = "Candidate", values_to = "Percentage")
Midterm_long$Label <- paste0(Midterm_long$Percentage, "%")
# labels placement
Midterm_long <- Midterm_long %>%
mutate(
v_nudge = case_when(
Candidate == "Other"      ~ 2.1,
Candidate == "Democrat"   ~ -1.6,
Candidate == "Republican" ~ -1.0,
TRUE                      ~ 0
),
h_nudge = case_when(
Candidate == "Other"      ~ 0,
Candidate == "Democrat"   ~ 0.15,
Candidate == "Republican" ~ 0.15,
TRUE                      ~ 0
)
)
# labels placement
change_labels <- Midterm %>%
summarise(
Democrat    = round(Democrat[Year == "2024"] - Democrat[Year == "2020"], 1),
Republican  = round(Republican[Year == "2024"] - Republican[Year == "2020"], 1),
Other       = round(Other[Year == "2024"] - Other[Year == "2020"], 1)
) %>%
pivot_longer(cols = everything(), names_to = "Candidate", values_to = "Change") %>%
mutate(
Label = paste0("Δ ", Change, "%"),
x = 1.5,
y = c(mean(c(51.3, 48.3)), mean(c(46.9, 49.8)), mean(c(1.8, 1.9))),
v_nudge = case_when(
Candidate == "Other"      ~ 1.5,
Candidate == "Democrat"   ~ 1,
Candidate == "Republican" ~ -1.5,
TRUE                      ~ 0
),
h_nudge = case_when(
Candidate == "Other"      ~ 0,
Candidate == "Democrat"   ~ 0.1,
Candidate == "Republican" ~ 0.1,
TRUE                      ~ 0
)
)
# Insert Δchange
ggplot(Midterm_long, aes(x = Year, y = Percentage, group = Candidate, color = Candidate)) +
geom_line(linewidth  = 1.2, alpha = 0.8) +
geom_point(size = 4) +
geom_text(aes(x = as.numeric(as.factor(Year)) + h_nudge,
y = Percentage + v_nudge,
label = Label),
size = 3.5) +
geom_text(data = change_labels,
aes(x = x + h_nudge, y = y + v_nudge, label = Label, color = Candidate),
fontface = "bold", size = 4, inherit.aes = FALSE) +
scale_x_discrete(limits = c("2020", "2024")) +
scale_color_manual(values = c("Democrat" = "#1f77b4", "Republican" = "red", "Other" = "gray40")) +
labs(title = "Vote Share by Candidate (2020 vs 2024)",
subtitle = "Δ labels show change in vote share",
x = "Year",
y = "Percentage of Vote",
color = "Candidate") +
theme_minimal()
flows <- readr::read_csv("flows.csv") |>
mutate(
source_2020 = factor(source_2020, levels = c("Trump2020","Biden2020","Nonvoter2020")),
to_2024     = factor(to_2024, levels = c("Harris","Trump","Other","DidNotVote"))
cohort_bars <- flows |>
flows <- readr::read_csv("flows.csv") |>
mutate(
source_2020 = factor(source_2020, levels = c("Trump2020","Biden2020","Nonvoter2020")),
to_2024     = factor(to_2024, levels = c("Harris","Trump","Other","DidNotVote"))
#| include: false
library(tidyverse)
flows <- readr::read_csv("flows.csv") |>
mutate(
source_2020 = factor(source_2020, levels = c("Trump2020","Biden2020","Nonvoter2020")),
to_2024     = factor(to_2024, levels = c("Harris","Trump","Other","DidNotVote"))
)
#| echo: false
cohort_bars <- flows |>
filter(source_2020 %in% c("Trump2020","Biden2020")) |>
mutate(category = case_when(
source_2020 == "Trump2020" & to_2024 == "Trump"  ~ "Retention",
source_2020 == "Biden2020" & to_2024 == "Harris" ~ "Retention",
source_2020 == "Trump2020" & to_2024 == "Harris" ~ "Switched",
source_2020 == "Biden2020" & to_2024 == "Trump"  ~ "Switched",
to_2024 == "DidNotVote"                           ~ "Drop-off",
TRUE                                              ~ "Other"
)) |>
group_by(source_2020, category) |>
summarise(percent = sum(percent), .groups = "drop") |>
mutate(category = factor(category, levels = c("Retention","Switched","Drop-off","Other")))
p2 <- ggplot(cohort_bars, aes(source_2020, percent, fill = category)) +
geom_col(position = position_dodge(width = 0.8), width = 0.7) +
geom_text(aes(label = round(percent,1)),
position = position_dodge(width = 0.8), vjust = -0.35, size = 3) +
scale_y_continuous(labels = scales::percent_format(scale = 1),
expand = expansion(mult = c(0, .08))) +
labs(
title = "Retention vs Switching vs Drop-off (Side-by-Side Comparison)",
x = "2020 Cohort", y = "Share of Cohort (%)", fill = "Outcome in 2024"
) +
theme_minimal(base_size = 12)
p2
library(tidyverse)
flows <- readr::read_csv("flows.csv") |>
mutate(
source_2020 = factor(source_2020, levels = c("Trump2020","Biden2020","Nonvoter2020")),
to_2024     = factor(to_2024, levels = c("Harris","Trump","Other","DidNotVote"))
)
flows <- readr::read_csv("flows.csv") |>
mutate(
source_2020 = factor(source_2020, levels = c("Trump2020","Biden2020","Nonvoter2020")),
to_2024     = factor(to_2024, levels = c("Harris","Trump","Other","DidNotVote"))
)
flows <- readr::read_csv("flows.csv") |>
mutate(
source_2020 = factor(source_2020, levels = c("Trump2020","Biden2020","Nonvoter2020")),
to_2024     = factor(to_2024, levels = c("Harris","Trump","Other","DidNotVote"))
)
cohort_bars <- flows |>
filter(source_2020 %in% c("Trump2020","Biden2020")) |>
mutate(category = case_when(
source_2020 == "Trump2020" & to_2024 == "Trump"  ~ "Retention",
source_2020 == "Biden2020" & to_2024 == "Harris" ~ "Retention",
source_2020 == "Trump2020" & to_2024 == "Harris" ~ "Switched",
source_2020 == "Biden2020" & to_2024 == "Trump"  ~ "Switched",
to_2024 == "DidNotVote"                           ~ "Drop-off",
TRUE                                              ~ "Other"
)) |>
group_by(source_2020, category) |>
summarise(percent = sum(percent), .groups = "drop") |>
mutate(category = factor(category, levels = c("Retention","Switched","Drop-off","Other")))
p2 <- ggplot(cohort_bars, aes(source_2020, percent, fill = category)) +
geom_col(position = position_dodge(width = 0.8), width = 0.7) +
geom_text(aes(label = round(percent,1)),
position = position_dodge(width = 0.8), vjust = -0.35, size = 3) +
scale_y_continuous(labels = scales::percent_format(scale = 1),
expand = expansion(mult = c(0, .08))) +
labs(
title = "Retention vs Switching vs Drop-off (Side-by-Side Comparison)",
x = "2020 Cohort", y = "Share of Cohort (%)", fill = "Outcome in 2024"
) +
theme_minimal(base_size = 12)
p2
p1 <- ggplot(flows |> filter(source_2020 %in% c("Trump2020","Biden2020")),
aes(source_2020, percent, fill = to_2024)) +
geom_col(position = "fill", width = 0.7, color = "white", linewidth = 0.2) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "2020 Cohorts in 2024: Normalized Composition (100% Stacked Bars)",
x = "2020 Cohort", y = "Share in 2024 (Proportion)", fill = "2024 Destination"
) +
theme_minimal(base_size = 12)
p1
#| include: false
knitr::opts_chunk$set(echo = FALSE)
library(readxl)
library(tidyverse)
#| echo: false
Midterm <- read_excel("Midterm.xlsx")
Midterm <- data.frame(
Year = c("2020", "2024"),
BH = c(51.3, 48.3),
T  = c(46.9, 49.8),
O  = c(1.8, 1.9)
)
Midterm <- data.frame(
Year = c("2020", "2024"),
BH = c(51.3, 48.3),
T  = c(46.9, 49.8),
O  = c(1.8, 1.9)
)
Midterm_long <- pivot_longer(Midterm, cols = c(BH, T, O), names_to = "Variable", values_to = "Value")
# Rename variables
Midterm_long$Variable <- recode(Midterm_long$Variable,
BH = "Democrat",
O  = "Other",
T  = "Republican")
# ordering
Midterm_long$Variable <- factor(Midterm_long$Variable, levels = c("Democrat", "Other", "Republican"))
Midterm_2020 <- subset(Midterm_long, Year == "2020")
Midterm_2024 <- subset(Midterm_long, Year == "2024")
# add percentage labels
Midterm_2020$Label <- paste0(Midterm_2020$Value, "%")
Midterm_2024$Label <- paste0(Midterm_2024$Value, "%")
# overlapping labels
library(ggplot2)
ggplot() +
geom_bar(data = Midterm_2020, aes(x = Variable, y = Value, fill = "2020"),
stat = "identity", position = "identity", alpha = 0.8) +
geom_text(data = Midterm_2020, aes(x = Variable, y = Value, label = Label),
position = position_nudge(x = -0.15, y = 0.5),
color = "black", size = 3.5) +
geom_bar(data = Midterm_2024, aes(x = Variable, y = Value, fill = "2024"),
stat = "identity", position = "identity", alpha = 0.4) +
geom_text(data = Midterm_2024, aes(x = Variable, y = Value, label = Label),
position = position_nudge(x = 0.15, y = -0.5),
color = "black", size = 3.5) +
scale_fill_manual(values = c("2020" = "#1f77c1", "2024" = "#FF0000")) +
labs(title = "Difference In Election Outcomes From 2020 To 2024",
x = "Candidates",
y = "Percentage of Vote",
fill = "Year") +
theme_minimal()
Midterm <- read_excel("Midterm.xlsx")
Midterm <- data.frame(
Year = c("2020", "2024"),
BH = c(51.3, 48.3),
T  = c(46.9, 49.8),
O  = c(1.8, 1.9)
)
Midterm <- data.frame(
Year = c("2020", "2024"),
BH = c(51.3, 48.3),
T  = c(46.9, 49.8),
O  = c(1.8, 1.9)
)
Midterm_long <- pivot_longer(Midterm, cols = c(BH, T, O), names_to = "Variable", values_to = "Value")
# Rename variables
Midterm_long$Variable <- recode(Midterm_long$Variable,
BH = "Democrat",
O  = "Other",
T  = "Republican")
# ordering
Midterm_long$Variable <- factor(Midterm_long$Variable, levels = c("Democrat", "Other", "Republican"))
Midterm_2020 <- subset(Midterm_long, Year == "2020")
Midterm_2024 <- subset(Midterm_long, Year == "2024")
# add percentage labels
Midterm_2020$Label <- paste0(Midterm_2020$Value, "%")
Midterm_2024$Label <- paste0(Midterm_2024$Value, "%")
# overlapping labels
library(ggplot2)
ggplot() +
geom_bar(data = Midterm_2020, aes(x = Variable, y = Value, fill = "2020"),
stat = "identity", position = "identity", alpha = 0.8) +
geom_text(data = Midterm_2020, aes(x = Variable, y = Value, label = Label),
position = position_nudge(x = -0.15, y = 0.5),
color = "black", size = 3.5) +
geom_bar(data = Midterm_2024, aes(x = Variable, y = Value, fill = "2024"),
stat = "identity", position = "identity", alpha = 0.4) +
geom_text(data = Midterm_2024, aes(x = Variable, y = Value, label = Label),
position = position_nudge(x = 0.15, y = -0.5),
color = "black", size = 3.5) +
scale_fill_manual(values = c("2020" = "#1f77c1", "2024" = "#FF0000")) +
labs(title = "Difference In Election Outcomes From 2020 To 2024",
x = "Candidates",
y = "Percentage of Vote",
fill = "Year") +
theme_minimal()
library(readxl)
Midterm <- read_excel("Midterm.xlsx")
Midterm <- data.frame(
Year = c("2020", "2024"),
BH = c(51.3, 48.3),
T  = c(46.9, 49.8),
O  = c(1.8, 1.9)
)
Midterm <- data.frame(
Year = c("2020", "2024"),
BH = c(51.3, 48.3),
T  = c(46.9, 49.8),
O  = c(1.8, 1.9)
)
Midterm_long <- pivot_longer(Midterm, cols = c(BH, T, O), names_to = "Variable", values_to = "Value")
# Rename variables
Midterm_long$Variable <- recode(Midterm_long$Variable,
BH = "Democrat",
O  = "Other",
T  = "Republican")
# ordering
Midterm_long$Variable <- factor(Midterm_long$Variable, levels = c("Democrat", "Other", "Republican"))
Midterm_2020 <- subset(Midterm_long, Year == "2020")
Midterm_2024 <- subset(Midterm_long, Year == "2024")
# add percentage labels
Midterm_2020$Label <- paste0(Midterm_2020$Value, "%")
Midterm_2024$Label <- paste0(Midterm_2024$Value, "%")
# overlapping labels
library(ggplot2)
ggplot() +
geom_bar(data = Midterm_2020, aes(x = Variable, y = Value, fill = "2020"),
stat = "identity", position = "identity", alpha = 0.8) +
geom_text(data = Midterm_2020, aes(x = Variable, y = Value, label = Label),
position = position_nudge(x = -0.15, y = 0.5),
color = "black", size = 3.5) +
geom_bar(data = Midterm_2024, aes(x = Variable, y = Value, fill = "2024"),
stat = "identity", position = "identity", alpha = 0.4) +
geom_text(data = Midterm_2024, aes(x = Variable, y = Value, label = Label),
position = position_nudge(x = 0.15, y = -0.5),
color = "black", size = 3.5) +
scale_fill_manual(values = c("2020" = "#1f77c1", "2024" = "#FF0000")) +
labs(title = "Difference In Election Outcomes From 2020 To 2024",
x = "Candidates",
y = "Percentage of Vote",
fill = "Year") +
theme_minimal()
#| include: false
library(tidyverse)
flows <- readr::read_csv("flows.csv") |>
mutate(
source_2020 = factor(source_2020, levels = c("Trump2020","Biden2020","Nonvoter2020")),
to_2024     = factor(to_2024, levels = c("Harris","Trump","Other","DidNotVote"))
)
#| echo: false
p1 <- ggplot(flows |> filter(source_2020 %in% c("Trump2020","Biden2020")),
aes(source_2020, percent, fill = to_2024)) +
geom_col(position = "fill", width = 0.7, color = "white", linewidth = 0.2) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "2020 Cohorts in 2024: Normalized Composition (100% Stacked Bars)",
x = "2020 Cohort", y = "Share in 2024 (Proportion)", fill = "2024 Destination"
) +
theme_minimal(base_size = 12)
p1
